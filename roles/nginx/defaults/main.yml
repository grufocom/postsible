---
# Nginx Defaults for Postsible

# Nginx user
nginx_user: "www-data"
nginx_group: "www-data"

# Nginx worker processes (-1 = auto, uses CPU core count)
nginx_worker_processes: "auto"
nginx_worker_connections: 1024

# Nginx ports
nginx_http_port: 80
nginx_https_port: 443

# Server names
nginx_server_name: "{{ ansible_fqdn }}"
nginx_webmail_server_name: "webmail.{{ mail_primary_domain }}"

# SSL Configuration (will be auto-detected, these are fallbacks)
nginx_ssl_cert: "/etc/ssl/certs/ssl-cert-snakeoil.pem"
nginx_ssl_key: "/etc/ssl/private/ssl-cert-snakeoil.key"
nginx_ssl_enabled: false  # Will be set to true by ssl-detection if certs exist
nginx_ssl_source: "Not detected"  # Will be set by ssl-detection

# Optional: Custom certificates (if not using Let's Encrypt)
# nginx_custom_ssl_cert: "/path/to/custom.crt"
# nginx_custom_ssl_key: "/path/to/custom.key"

# SSL protocols and ciphers
nginx_ssl_protocols: "TLSv1.2 TLSv1.3"
nginx_ssl_ciphers: "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384"
nginx_ssl_prefer_server_ciphers: "off"
nginx_ssl_session_timeout: "1d"
nginx_ssl_session_cache: "shared:SSL:10m"
nginx_ssl_session_tickets: "off"

# Security headers
nginx_security_headers_enabled: true
nginx_hsts_enabled: false  # Will be auto-enabled by ssl-detection if proper SSL exists
nginx_hsts_max_age: 31536000

# PHP-FPM configuration
nginx_php_fpm_enabled: true
nginx_php_version: "8.4"  # Debian 13 default
nginx_php_fpm_socket: "/run/php/php{{ nginx_php_version }}-fpm.sock"
nginx_php_fpm_pm: "dynamic"
nginx_php_fpm_max_children: 5
nginx_php_fpm_start_servers: 2
nginx_php_fpm_min_spare_servers: 1
nginx_php_fpm_max_spare_servers: 3

# Rspamd WebUI
nginx_rspamd_webui_enabled: "{{ rspamd_webui_enabled | default(true) }}"
nginx_rspamd_webui_path: "/rspamd"
nginx_rspamd_port: 11334

# SnappyMail configuration
nginx_snappymail_enabled: false
snappymail_install_dir: "/var/www/snappymail"
snappymail_upload_max_size: "50M"
snappymail_post_max_size: "50M"

# Client body size (for email attachments)
nginx_client_max_body_size: "50m"

# Logging
nginx_access_log: "/var/log/nginx/access.log"
nginx_error_log: "/var/log/nginx/error.log"
nginx_log_format: 'main'
